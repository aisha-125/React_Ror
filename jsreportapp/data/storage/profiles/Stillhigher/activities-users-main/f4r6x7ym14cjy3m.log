{"type":"operationStart","subtype":"profile","data":{"_id":"KqIf7hlUrMN3Dcr5","timestamp":"2024-01-12T23:26:50.390Z","state":"queued","mode":"standard","creationDate":"2024-01-12T23:26:50.393Z","modificationDate":"2024-01-12T23:26:50.393Z","shortid":"V9lup_X","$entitySet":"profiles"},"doDiffs":false,"timestamp":1705102010392,"id":"t0pa383wgkbu20p","previousOperationId":null,"operationId":"fveud9iur7hb1ox"}
{"type":"log","level":"info","message":"Render request 5 queued for execution and waiting for available worker","previousOperationId":"fveud9iur7hb1ox","timestamp":1705102010392,"id":"hz6vgfp6xrls2xj"}
{"type":"operationStart","subtype":"render","name":"activities-users-main","previousOperationId":"fveud9iur7hb1ox","timestamp":1705102010407,"id":"9z24sapogth8vey","previousEventId":"t0pa383wgkbu20p","operationId":"y5uysrq1i8pysiq"}
{"type":"log","timestamp":1705102010407,"level":"info","message":"Starting rendering request 5","meta":{"rootId":"f4r6x7ym14cjy3m","id":"f4r6x7ym14cjy3m"},"id":"8v8xk7go0xnz1x1","previousOperationId":"y5uysrq1i8pysiq"}
{"type":"log","timestamp":1705102010408,"level":"info","message":"Rendering template { name: activities-users-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"f4r6x7ym14cjy3m","id":"f4r6x7ym14cjy3m"},"id":"iaei1z67s2eelo8","previousOperationId":"y5uysrq1i8pysiq"}
{"type":"log","timestamp":1705102010408,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"f4r6x7ym14cjy3m","id":"f4r6x7ym14cjy3m"},"id":"6el8fxma4ktuggm","previousOperationId":"y5uysrq1i8pysiq"}
{"type":"log","timestamp":1705102010412,"level":"debug","message":"Executing script users-script (beforeRender)","meta":{"rootId":"f4r6x7ym14cjy3m","id":"f4r6x7ym14cjy3m"},"id":"i0v6tys9mujjlxk","previousOperationId":"y5uysrq1i8pysiq"}
{"type":"operationStart","subtype":"scriptsBeforeRender","name":"scripts beforeRender","timestamp":1705102010427,"id":"y4fekdmt1gq7qme","previousEventId":"9z24sapogth8vey","operationId":"oa5qh0cy70tz7ra","previousOperationId":"y5uysrq1i8pysiq"}
{"type":"operationStart","subtype":"script","name":"scripts users-script","previousOperationId":"oa5qh0cy70tz7ra","timestamp":1705102010427,"id":"kpjc07xqv52vrsx","previousEventId":"y4fekdmt1gq7qme","operationId":"uhfn59b88kha680"}
{"type":"log","timestamp":1705102010427,"level":"debug","message":"(console:log) hora","meta":{"userLevel":true,"rootId":"f4r6x7ym14cjy3m","id":"f4r6x7ym14cjy3m"},"id":"odh1agvvc3btwho","previousOperationId":"uhfn59b88kha680"}
{"type":"log","timestamp":1705102010565,"level":"warn","message":"Error when processing render request 5\n(because) error when evaluating custom script /Stillhigher/users-script\nactivities is not defined\n\n(sandbox.js line 52:17)\n\n  50 | async function beforeRender(req, res) {\n  51 |     req.data.activities = await fetchActivities();\n> 52 |     console.log(activities);\n     |                 ^\n  53 | }\n\n\nReferenceError: activities is not defined\n    at Object.beforeRender (sandbox.js:52:17)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async executionFn (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:67:11)\n    at async run (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/createSandbox.js:137:16)\n    at async WorkerReporter.runInSandbox [as _runInSandbox] (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/runInSandbox.js:195:14)\n    at async executeScript (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:122:12)\n    at async Scripts._runScript (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/worker.js:140:30)\n    at async Scripts.handleBeforeRender (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/worker.js:64:7)\n    at async ListenerCollection.fire (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-core/lib/shared/listenerCollection.js:157:21)\n    at async beforeRender (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/render/render.js:24:5)","meta":{"rootId":"f4r6x7ym14cjy3m","id":"f4r6x7ym14cjy3m"},"id":"pt5ekeqepl4uw26","previousOperationId":"uhfn59b88kha680"}
{"type":"log","timestamp":1705102010565,"level":"warn","message":"Rendering request 5 finished with error in 175 ms","meta":{"rootId":"f4r6x7ym14cjy3m","id":"f4r6x7ym14cjy3m"},"id":"sh5g2aburi49ocr","previousOperationId":"uhfn59b88kha680"}
{"type":"error","timestamp":1705102010569,"statusCode":400,"weak":true,"lineNumber":52,"decoratedSuffix":"\n\n(sandbox.js line 52:17)\n\n  50 | async function beforeRender(req, res) {\n  51 |     req.data.activities = await fetchActivities();\n> 52 |     console.log(activities);\n     |                 ^\n  53 | }\n\n","entity":{"shortid":"z0qYUNaQrV","name":"users-script","content":"const http = require('http');\n\nfunction fetchActivities() {\n    console.log('hora');\n    return new Promise((resolve, reject) => {\n        http.get('http://localhost:4000/api/v1/activities',\n        (result) => {\n            var str = '';\n            result.on('data', (b) => str += b);\n            result.on('error', reject);\n            result.on('end', () => resolve(JSON.parse(str).value));\n        });\n    });\n}\n\n// group the data for report\n// async function prepareDataSource() {\n//     const orders = await fetchOrders()\n//     const ordersByShipCountry = orders.reduce((a, v) => {\n//         a[v.ShipCountry] = a[v.ShipCountry] || []\n//         a[v.ShipCountry].push(v)\n//         return a\n//     }, {})\n\n//     return Object.keys(ordersByShipCountry).map((country) => {\n//         const ordersInCountry = ordersByShipCountry[country]\n\n//         const accumulated = {}\n\n//         ordersInCountry.forEach((o) => {\n//             o.OrderDate = new Date(o.OrderDate);\n//             const key = o.OrderDate.getFullYear() + '/' + (o.OrderDate.getMonth() + 1);\n//             accumulated[key] = accumulated[key] || {\n//                 value: 0,\n//                 orderDate: o.OrderDate\n//             };\n//             accumulated[key].value++;\n//         });\n\n//         return {\n//             rows: ordersInCountry,\n//             country,\n//             accumulated\n//         }\n\n//     }).slice(0, 2)\n// }\n\n// add jsreport hook which modifies the report input data\nasync function beforeRender(req, res) {\n    req.data.activities = await fetchActivities();\n    console.log(activities);\n}"},"property":"content","logged":true,"previousOperationId":"uhfn59b88kha680","id":"wqus1bx83lyghb0","stack":"ReferenceError: activities is not defined\n    at Object.beforeRender (sandbox.js:52:17)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async executionFn (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:67:11)\n    at async run (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/createSandbox.js:137:16)\n    at async WorkerReporter.runInSandbox [as _runInSandbox] (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/runInSandbox.js:195:14)\n    at async executeScript (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:122:12)\n    at async Scripts._runScript (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/worker.js:140:30)\n    at async Scripts.handleBeforeRender (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/worker.js:64:7)\n    at async ListenerCollection.fire (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-core/lib/shared/listenerCollection.js:157:21)\n    at async beforeRender (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/render/render.js:24:5)","message":"Error when evaluating custom script /Stillhigher/users-script\nactivities is not defined\n\n(sandbox.js line 52:17)\n\n  50 | async function beforeRender(req, res) {\n  51 |     req.data.activities = await fetchActivities();\n> 52 |     console.log(activities);\n     |                 ^\n  53 | }\n\n"}
