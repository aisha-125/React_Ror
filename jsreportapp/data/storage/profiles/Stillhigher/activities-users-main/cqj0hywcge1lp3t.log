{"type":"operationStart","subtype":"profile","data":{"_id":"Qs6SVthlfN88xQsB","timestamp":"2024-01-12T23:26:59.265Z","state":"queued","mode":"standard","creationDate":"2024-01-12T23:26:59.267Z","modificationDate":"2024-01-12T23:26:59.267Z","shortid":"2LyMHDp","$entitySet":"profiles"},"doDiffs":false,"timestamp":1705102019266,"id":"70q9kpfn5vo62ux","previousOperationId":null,"operationId":"5yunyialg8whl41"}
{"type":"log","level":"info","message":"Render request 7 queued for execution and waiting for available worker","previousOperationId":"5yunyialg8whl41","timestamp":1705102019266,"id":"b83qv9rfztzfxby"}
{"type":"operationStart","subtype":"render","name":"activities-users-main","previousOperationId":"5yunyialg8whl41","timestamp":1705102019281,"id":"5i5yqmrkzi5p8f8","previousEventId":"70q9kpfn5vo62ux","operationId":"p89ps6wjb5jb0dn"}
{"type":"log","timestamp":1705102019281,"level":"info","message":"Starting rendering request 7","meta":{"rootId":"cqj0hywcge1lp3t","id":"cqj0hywcge1lp3t"},"id":"yu28fz096fdsyfa","previousOperationId":"p89ps6wjb5jb0dn"}
{"type":"log","timestamp":1705102019282,"level":"info","message":"Rendering template { name: activities-users-main, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"cqj0hywcge1lp3t","id":"cqj0hywcge1lp3t"},"id":"m5sqqm9acfa8iuo","previousOperationId":"p89ps6wjb5jb0dn"}
{"type":"log","timestamp":1705102019283,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"cqj0hywcge1lp3t","id":"cqj0hywcge1lp3t"},"id":"lc1qz138c5ttvtg","previousOperationId":"p89ps6wjb5jb0dn"}
{"type":"log","timestamp":1705102019286,"level":"debug","message":"Executing script users-script (beforeRender)","meta":{"rootId":"cqj0hywcge1lp3t","id":"cqj0hywcge1lp3t"},"id":"25lfy4rc1fu7syp","previousOperationId":"p89ps6wjb5jb0dn"}
{"type":"operationStart","subtype":"scriptsBeforeRender","name":"scripts beforeRender","timestamp":1705102019296,"id":"xm5cxnk2zmx1vbr","previousEventId":"5i5yqmrkzi5p8f8","operationId":"wxxwuexrmwwm0c2","previousOperationId":"p89ps6wjb5jb0dn"}
{"type":"operationStart","subtype":"script","name":"scripts users-script","previousOperationId":"wxxwuexrmwwm0c2","timestamp":1705102019296,"id":"nuutxs075mj8otn","previousEventId":"xm5cxnk2zmx1vbr","operationId":"l2545o295zf640o"}
{"type":"log","timestamp":1705102019297,"level":"debug","message":"(console:log) hora","meta":{"userLevel":true,"rootId":"cqj0hywcge1lp3t","id":"cqj0hywcge1lp3t"},"id":"cysh50xnao74be7","previousOperationId":"l2545o295zf640o"}
{"type":"log","timestamp":1705102019452,"level":"warn","message":"Error when processing render request 7\n(because) error when evaluating custom script /Stillhigher/users-script\nactivities is not defined\n\n(sandbox.js line 52:17)\n\n  50 | async function beforeRender(req, res) {\n  51 |     req.data.activities = await fetchActivities();\n> 52 |     console.log(activities);\n     |                 ^\n  53 | }\n\n\nReferenceError: activities is not defined\n    at Object.beforeRender (sandbox.js:52:17)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async executionFn (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:67:11)\n    at async run (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/createSandbox.js:137:16)\n    at async WorkerReporter.runInSandbox [as _runInSandbox] (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/runInSandbox.js:195:14)\n    at async executeScript (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:122:12)\n    at async Scripts._runScript (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/worker.js:140:30)\n    at async Scripts.handleBeforeRender (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/worker.js:64:7)\n    at async ListenerCollection.fire (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-core/lib/shared/listenerCollection.js:157:21)\n    at async beforeRender (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/render/render.js:24:5)","meta":{"rootId":"cqj0hywcge1lp3t","id":"cqj0hywcge1lp3t"},"id":"4g80w1yg4s1udf0","previousOperationId":"l2545o295zf640o"}
{"type":"log","timestamp":1705102019452,"level":"warn","message":"Rendering request 7 finished with error in 188 ms","meta":{"rootId":"cqj0hywcge1lp3t","id":"cqj0hywcge1lp3t"},"id":"bn869963ljeouyz","previousOperationId":"l2545o295zf640o"}
{"type":"error","timestamp":1705102019455,"statusCode":400,"weak":true,"lineNumber":52,"decoratedSuffix":"\n\n(sandbox.js line 52:17)\n\n  50 | async function beforeRender(req, res) {\n  51 |     req.data.activities = await fetchActivities();\n> 52 |     console.log(activities);\n     |                 ^\n  53 | }\n\n","entity":{"shortid":"z0qYUNaQrV","name":"users-script","content":"const http = require('http');\n\nfunction fetchActivities() {\n    console.log('hora');\n    return new Promise((resolve, reject) => {\n        http.get('http://localhost:4000/api/v1/activities',\n        (result) => {\n            var str = '';\n            result.on('data', (b) => str += b);\n            result.on('error', reject);\n            result.on('end', () => resolve(JSON.parse(str).value));\n        });\n    });\n}\n\n// group the data for report\n// async function prepareDataSource() {\n//     const orders = await fetchOrders()\n//     const ordersByShipCountry = orders.reduce((a, v) => {\n//         a[v.ShipCountry] = a[v.ShipCountry] || []\n//         a[v.ShipCountry].push(v)\n//         return a\n//     }, {})\n\n//     return Object.keys(ordersByShipCountry).map((country) => {\n//         const ordersInCountry = ordersByShipCountry[country]\n\n//         const accumulated = {}\n\n//         ordersInCountry.forEach((o) => {\n//             o.OrderDate = new Date(o.OrderDate);\n//             const key = o.OrderDate.getFullYear() + '/' + (o.OrderDate.getMonth() + 1);\n//             accumulated[key] = accumulated[key] || {\n//                 value: 0,\n//                 orderDate: o.OrderDate\n//             };\n//             accumulated[key].value++;\n//         });\n\n//         return {\n//             rows: ordersInCountry,\n//             country,\n//             accumulated\n//         }\n\n//     }).slice(0, 2)\n// }\n\n// add jsreport hook which modifies the report input data\nasync function beforeRender(req, res) {\n    req.data.activities = await fetchActivities();\n    console.log(activities);\n}"},"property":"content","logged":true,"previousOperationId":"l2545o295zf640o","id":"9k1j1yna1krghet","stack":"ReferenceError: activities is not defined\n    at Object.beforeRender (sandbox.js:52:17)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async executionFn (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:67:11)\n    at async run (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/createSandbox.js:137:16)\n    at async WorkerReporter.runInSandbox [as _runInSandbox] (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/runInSandbox.js:195:14)\n    at async executeScript (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:122:12)\n    at async Scripts._runScript (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/worker.js:140:30)\n    at async Scripts.handleBeforeRender (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-scripts/lib/worker.js:64:7)\n    at async ListenerCollection.fire (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-core/lib/shared/listenerCollection.js:157:21)\n    at async beforeRender (/home/ruby/workspace/React_RoR/jsreportapp/node_modules/@jsreport/jsreport-core/lib/worker/render/render.js:24:5)","message":"Error when evaluating custom script /Stillhigher/users-script\nactivities is not defined\n\n(sandbox.js line 52:17)\n\n  50 | async function beforeRender(req, res) {\n  51 |     req.data.activities = await fetchActivities();\n> 52 |     console.log(activities);\n     |                 ^\n  53 | }\n\n"}
